.. include:: links.rst

.. _outputs:

------------------------------
Outputs of *fMRIPost-template*
------------------------------

*fMRIPost-template* outputs conform to the :abbr:`BIDS (brain imaging data structure)`
Derivatives specification (see `BIDS Derivatives`_, along with the
upcoming `BEP 011`_ and `BEP 012`_).
*fMRIPost-template* generates three broad classes of outcomes:

1.  **Visual QA (quality assessment) reports**:
    One :abbr:`HTML (hypertext markup language)` per subject,
    that allows the user a thorough visual assessment of the quality
    of processing and ensures the transparency of *fMRIPost-template* operation.

2.  **Derivatives**:
    Output fMRI data in the requested output spaces and resolutions.

3.  **Confounds**:
    Confound time series.


Layout
------

Assuming fMRIPost-template is invoked with::

    fmripost_template <input_dir>/ <output_dir>/ participant [OPTIONS]

The outputs will be a `BIDS Derivatives`_ dataset of the form::

    <output_dir>/
      logs/
      sub-<label>/
      sub-<label>.html
      dataset_description.json
      .bidsignore

For each participant in the dataset,
a directory of derivatives (``sub-<label>/``)
and a visual report (``sub-<label>.html``) are generated.
The log directory contains `citation boilerplate`_ text.
``dataset_description.json`` is a metadata file in which fMRIPost-template
records metadata recommended by the BIDS standard.


Visual Reports
--------------

*fMRIPost-template* outputs summary reports,
written to ``<output dir>/fmripost_template/sub-<label>.html``.
These reports provide a quick way to make visual inspection of the results easy.


Derivatives of *fMRIPost-template*
----------------------------------

Derivative data are written to
``<output dir>/sub-<label>/``.
The `BIDS Derivatives`_ specification describes the naming and metadata conventions we follow.


Functional derivatives
~~~~~~~~~~~~~~~~~~~~~~

Functional derivatives are stored in the ``func/`` subfolder.
All derivatives contain ``task-<task_label>`` (mandatory) and ``run-<run_index>`` (optional), and
these will be indicated with ``[specifiers]``::

  sub-<label>/
    func/
      sub-<label>_[specifiers]_space-MNI152NLin6Asym_res-2_desc-result_boldmap.nii.gz

**Regularly gridded outputs (images)**.
Volumetric output spaces labels (``<label>`` above, and in the following) include
``MNI152NLin6Asym`` (default).

**Extracted confounding time series**.
For each :abbr:`BOLD (blood-oxygen level dependent)` run processed with *fMRIPost-template*,
an accompanying *confounds* file will be generated.
Confounds_ are saved as a :abbr:`TSV (tab-separated value)` file::

  sub-<label>/
    func/
      sub-<label>_[specifiers]_desc-confounds_timeseries.tsv
      sub-<label>_[specifiers]_desc-confounds_timeseries.json

Confounds
---------

*fMRIPost-template* outputs a set of confounds that can be used to denoise the data.
These are stored in a TSV file (``desc-template_timeseries.tsv``) and a JSON file
(``desc-template_timeseries.json``) that contains metadata about the confounds.

The confounds generated by *fMRIPost-template* are ICA component time series
classified as "rejected" by ICA-template.

Columns starting with ``template_motion_`` are the raw noise ICA component time series.
Columns starting with ``template_orth_motion_`` are the noise ICA component time series,
after z-scoring and orthogonalization with respect to the signal ICA component time series.

Confounds and "carpet"-plot on the visual reports
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The visual reports provide several sections per task and run to aid designing
a denoising strategy for subsequent analysis.
Some of the estimated confounds are plotted with a "carpet" visualization of the
:abbr:`BOLD (blood-oxygen level-dependent)` time series [Power2016]_.
An example of these plots follows:

See implementation on :mod:`~fmripost_template.workflows.bold.confounds.init_bold_confs_wf`.
